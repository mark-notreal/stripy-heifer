# Progress log

This document records the overall progress made on the take-home assignment, with timestamps. All times recorded in Pacific Standard Time (GMT-8 as of this writing).

## Phase 1 - scan the docs

| Date   | Time   | Progress                                                                                                                                                  | Thoughts                                                                                                                                                                                                                                                                                                                                         | Friction                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------ | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Feb 26 | 2:07pm | Read through PM take-home assignment instructions.                                                                                                        | When ramping up members on our team, we often put them through a similar exercise but do not give them a set of starting links. This tests other aspects of developer experience, such as SEO. In particular, with authentication developer searches tend to be less predictable so doc discovery is a friction point for many of our customers. |
|        | 2:09pm | Created and cloned empty GitHub repo, created [progress-log.md](progress-log.md) to record steps, progress, and friction.                                 |                                                                                                                                                                                                                                                                                                                                                  |
|        | 2:11pm | Start scanning the 4 docs linked in take-home assignment.                                                                                                 | I have always thought the Stripe docs are amazing for developer experience. In particular, the small interactive bits have just blown me away historically. That said, I have not actually read them to use the Stripe API, so this should be a good test.                                                                                       |
|        |        |                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                  | When reviewing <https://stripe.com/docs/payments/accept-a-payment#web>, it hints ("Always decide how much to charge on the server side... prevents malicious clients from being able to choose their own prices.") at the fact that you need a server and a client, but it's not explicit. A better approach might be to start with a simple architectural diagram that calls out server and client responsibilities in the overall payment flow.     |
|        |        |                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                  | Looking at the sample in <https://stripe.com/docs/payments/accept-a-payment#set-up-stripe-elements>, I have a concern about whether the secret will be visible to clients. I guess that will be answered down the road/as I investigate, but it disrupted my thought flow in a bad way.                                                                                                                                                               |
|        |        |                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                  | Reading through the [fourth step](https://stripe.com/docs/payments/accept-a-payment#web-submit-payment), I am even more concerned about the client secret (emphasis mine): "The client secret should still be handled carefully _because it can complete the charge_. Do not log it, embed it in URLs, or expose it to anyone but the customer." Again, this is where a flow up front might have been helpful in allaying any concern.                |
|        |        |                                                                                                                                                           |                                                                                                                                                                                                                                                                                                                                                  | Rereading the steps, I now see that the "client secret" is generated as a response to the server-side API call. That allays my fears, but underscores the point made previously that the sequence diagram would have made this obvious. Note: this may be an artifact of the fact that I am jumping between reading a couple paragraphs of the docs and recording thoughts here. If I were only reading, maybe I wouldn't have missed that paragraph. |
|        | 2:25pm | I have completed reading the overview docs. I now feel I understand the process at a high level. Assuming I understand correctly, the flow is as follows. | It would not typically take me 20 minutes to read and grok that amount of documentation, I would estimate 75% of the time was spent capturing friction.                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

```text
+---------+                                                   +---------+                                                   +---------+
| client  |                                                   | server  |                                                   | Stripe  |
+---------+                                                   +---------+                                                   +---------+
|                                                             |                                                             |
| What donation options are available?                        |                                                             |
|------------------------------------------------------------>|                                                             |
|                                                             |                                                             |
|                                           $10, $25, or $50. |                                                             |
|<------------------------------------------------------------|                                                             |
|                                                             |                                                             |
| Ok, I'd like to donate $25 USD.                             |                                                             |
|------------------------------------------------------------>|                                                             |
|                                                             |                                                             |
|                             Great, let me get that started. |                                                             |
|<------------------------------------------------------------|                                                             |
|                                                             |                                                             | ------------------------------------------------------------------------------\
|                                                             |                                                             |-| https://stripe.com/docs/payments/accept-a-payment#web-create-payment-intent |
|                                                             |                                                             | |-----------------------------------------------------------------------------|
|                                                             |                                                             |
|                                                             | Create a PaymentIntent for $25 USD.                         |
|                                                             |------------------------------------------------------------>|
|                                                             |                                                             |
|                                                             |               Done, the client secret is 'pk_test_TYoo...'. |
|                                                             |<------------------------------------------------------------|
|                                                             |                                                             | -----------------------------------------------------------------------------\
|                                                             |                                                             |-| https://stripe.com/docs/payments/accept-a-payment#web-collect-card-details |
|                                                             |                                                             | |----------------------------------------------------------------------------|
|                                                             |                                                             | -----------------------------------------------------------------------\
|                                                             |                                                             |-| https://stripe.com/docs/payments/accept-a-payment#web-submit-payment |
|                                                             |                                                             | |----------------------------------------------------------------------|
|                                                             |                                                             |
|      Pay Stripe with this client secret: 'pk_test_TYoo...'. |                                                             |
|<------------------------------------------------------------|                                                             |
|                                                             |                                                             |
| Here are my card details for payment of 'pk_test_TYoo...'.  |                                                             |
|-------------------------------------------------------------------------------------------------------------------------->|
|                                                             |                                                             |
|                                                             |                               Payment succeeded, thank you! |
|<--------------------------------------------------------------------------------------------------------------------------|
|                                                             |                                                             | --------------------------------------------------------------------\
|                                                             |                                                             |-| https://stripe.com/docs/payments/accept-a-payment#web-fulfillment |
|                                                             |                                                             | |-------------------------------------------------------------------|
|                                                             |                                                             |
|                                                             |      (via Webhook) Payment succeeded for 'pk_test_TYoo...'. |
|                                                             |<------------------------------------------------------------|
|                                                             |                                                             |
```

> Courtesy of <https://textart.io/sequence>.

## Phase 2 - look for samples and SDKs

| Date   | Time   | Progress                                                                                                                                             | Thoughts                                                                                                                                                                                                                                                                                                                                                      | Friction                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------ | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Feb 26 | 2:28pm | Look for samples and SDKs.                                                                                                                           | I know I need to build a React app using a Stripe PaymentIntent. Given what I know about Stripe, I assume a pretty good sample already exists, so I will see what I can glean from that sample.                                                                                                                                                               | The first place I went was to <https://www.github.com/stripe>. Although that organization exists, it was obviously the main repositories and not the samples - however, if you search for sample in the repository search, 4 repos do show up, which is confusing. I remembered seeing a reference to GitHub from the docs, so I went back and scanned again, and found a link to clone a sample in <https://stripe.com/docs/payments/accept-a-payment#web-overview>. That took me to <https://www.github.com/stripe-samples> which certainly seems to be the right home for samples. Unfortunately, this GitHub organization seems kind of hidden. I was lucky I had seen it in the docs. Searching for "sample" in the docs doesn't help much either. I've included what I would have expected to see in [Suggestions for improvement](suggestions-for-improvement.md). |
|        | 2:41pm | Start reviewing <https://github.com/stripe-samples/react-elements-card-payment>, which was thoughtfully pinned to the `stripe-samples` organization. | I have some specific things I'm looking for as I open up this sample: 1) component structure/layout and 2) server-side code, with the API being the most important thing. Because the Stripe docs mention this distinction I would expect to see it in the sample. I've built a few React apps but not enough to know that much about APIs coupled with them. |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 2:46pm |                                                                                                                                                      | The readme for this sample promises that a server is includes (5, actually!) and says that the Stripe CLI is the best way to get it running, so I am following that guidance.                                                                                                                                                                                 | On second thought, after reviewing the Stripe CLI instructions for Windows, I am going to put off installing the Stripe CLI. I don't want to install Scoop, and I certainly don't want to modify my PowerShell execution policy. Why isn't the Stripe CLI installable via npm?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|        | 2:52pm | Cloning and getting the sample running the hard way.                                                                                                 | No problems with cloning the repository, and while `yarn` was running on the client I was able to sign up for a developer account easily to get my API keys.                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 3:05pm | Sample up and running.                                                                                                                               | It was easy to get the sample to run. Now I need to test it.                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 3:08pm | Sample tested.                                                                                                                                       | Using the sample card information in the docs I was able to test the sample and verify that everything is posting successfully. I can see the payment intent in my Stripe dashboard and I was able to review the JSON in the sample UX.                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 3:10pm | Start reviewing server code.                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 3:17pm | Finished reviewing server code.                                                                                                                      | The server code is straightforward. As with React, I'm no Express expert but it was easy to read the code and understand what was happening.                                                                                                                                                                                                                  | The main question I have at this point is about all the code for handling Webhooks. That was approximately half the file, but obviously with a localhost URL it's complicated to get Webhooks running (probably why Stripe CLI exists in large part). At any rate, I spent several minutes reviewing the Dashboard UX for API keys, the code, and the readmes to verify that I hadn't missed anything. I don't think I have - I think the intent of the code is to a) show how Webhooks _should_ be handled and/or b) allow the sample to be published somewhere where Webhooks can actually be dispatched. Regardless, this was friction for me.                                                                                                                                                                                                                         |
|        | 3:24pm | Start reviewing client code.                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        | 3:34pm | Finished reviewing client code.                                                                                                                      | As with the server code, the client code is straightforward with minimal complexity and components. The most relevant code is in CheckoutForm.js, which makes sense. App.js and api.js help CheckoutForm by laying out the UX and calling the API respectively.                                                                                               | One challenge with React is the amount of evolution it has gone through, as evidenced in the public docs where there is a toggle between the `Hooks` and `Class Components` approaches. This is an unfortunate reality that I don't see an obvious solution to, but it does cause friction for devs that are new to React.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

At this point I am confident that I could trivially modify the sample to meet the requirements of the take-home assignment, but I am equally confident that isn't the "spirit" of the exercise. So, with the caveat that I am not a React or Express expert and I will need to steal bits and pieces from the samples, here we go into...

## Phase 3 - building stripy-heifer (without payments)

The app I will be building is called `stripy-heifer`. I've long been a fan of <https://www.heifer.org> and my first customer experience with accepting payments through Stripe was as part of a non-profit. Stripy-heifer is described more fully in the [readme](readme.md).

As mentioned previously, I have only a small amount of experience with React and Express, so I won't document my muddling through setting that up and getting the scaffolded site in place. Were I to be totally transparent, this phase took me a few hours because I cared about some details. My success criteria for the baseline included the following:

Goals

- [x] One folder to make it easy to manage in VS Code
- [x] Scaffold a react app from scratch using create-react-app
- [x] Build an ExpressJS API from scratch, CORS-enable it
- [x] Create the basic layout of the React app including at least two products with different currencies.
- [x] Leverage environment variables in both API and client for deployment purposes

Non-goals

- [ ] Make the app visually pleasing
- [ ] Make the code, especially in React, performant/efficient/scalable

Even with these relatively modest goals it took me a few hours to get everything up and running. Some of the delay was reflective of my lack of experience, some of the delay is just the basic challenges of debugging JavaScript/React apps.

That said, everything is now in place except for wiring up Stripe, so I am now well positioned to evaluate Stripe.js and Stripe Elements in...

## Phase 4 - enabling payments with Stripe

This phase is the most meaningful phase. I believe my React app and API are both working and talking to each other. The basic "functionality" of the React app, though limited, is complete. What really is left is the payment-enablement.

| Date   | Time   | Progress                                                                               | Thoughts                                                                                                                                                                                                                                         | Friction                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------ | ------ | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Feb 27 | 2:30pm | Starting the final phase of payment enablement with Stripe.                            | General plan: try to do this without the sample first, but refer to the sample if necessary.                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        | 2:35pm | Fiddled with .env in both API and Web and put my Stripe API keys in the API .env file. |                                                                                                                                                                                                                                                  | Aside: there seems to be some contradictory guidance about .env files and whether to use multiple with overrides or not, which is what I spent a bit more time on here.                                                                                                                                                                                                                                                                                                                                                                       |
|        | 2:45pm | Add stripe to API project, establish basic payment intent call.                        | I had the basic API call working within 15 minutes, plumbed all the way through from end-to-end (checkout form -> my API -> Stripe API). I like that I am able to confirm the payment intents by looking in the Stripe dashboard.                | One thing that surprised me and isn't mentioned in <https://stripe.com/docs/payments/accept-a-payment#web-create-payment-intent> is that the amount needs to be an integer corresponding to the "cents" in USD terms. I expected to be able to use a decimal value that Stripe would interpret accordingly. I wonder if this problem would be greater if there are currencies that don't primarily use base 10? I'm not going to put a lot of thought into that right now, but I will revisit it once I'm done with the basic implementation. |
|        | 3:15pm | Add stripe and Stripe Elements to Web project, render UX for payment intent.           | The test mode is once again super helpful. I found myself deleting extraneous payment intents (due to not handling `event.preventDefault` properly) and it was very nice to be able to confirm in a slick dashboard that everything was working. | One silly bug aside, it took me only a few additional minutes to get the payment processing working.                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|        |        |                                                                                        |                                                                                                                                                                                                                                                  | The [sample in the docs](https://stripe.com/docs/payments/accept-a-payment#add-stripejs-and-elements-to-your-page) is helpful but it doesn't show the contents of `<CheckoutForm/>`, which leaves developers needing to go find the right sample to see the rest of the code. It's also worth noting that I did need to see the full sample to figure out what I needed to do here.                                                                                                                                                           |
|        |        |                                                                                        |                                                                                                                                                                                                                                                  | Another friction point I ran into here is why `Elements` is needed at a higher level than `CardElement`. That forced me to restructure some of my React app in a way I didn't necessarily care about but also wasn't intuitive.                                                                                                                                                                                                                                                                                                               |

At this point I have a [working solution](https://github.com/markdstafford/stripe-pmtha/commit/643cdac4818267a3dd97054f88ad1931ee23de54) within an hour (from template to basic payment integration). It's admittedly wonky in places, such as the fact that I hard-coded the payment amount rather than using the total shown in the app. I have also gathered several possible improvements to the developer journey, but overall I am extremely impressed with the experience.

If time allows, here's where I plan to take this from this point:

- [x] Clean up everything I've written so far
- [x] Complete [readme.md](readme.md)
- [x] Verify that everything works from a clean clone
- [x] Handle Webhooks
- [x] Clean up code for submission
- [x] Investigate putting products into Stripe
- [x] Investigate payments that involve currency conversion
- [x] Investigate payments that involve multiple currencies
- [x] Investigate competitor APIs

A couple final notes as I wrap this up:

- I opted not to put products into Stripe for two reasons:
  1. There wasn't an obvious way to assign a price to them. I could fall back to metadata, but that feels clunky.
  2. It would have complicated the setup for reviewers - either the code would have to create the products if they don't exist, or no products would return. There are acceptable workarounds here, but weren't worth fiddling with for this exercise.
- I did look at PayPal's APIs. They seem acceptable at a high level, but they lack excellence and attention to detail, e.g.: `"city": "SAn Jose",`. I would need more time to form a more objective opinion.
